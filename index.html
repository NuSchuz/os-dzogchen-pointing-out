<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OpenSpace — Dzogchen Pointing-Out</title>
  <style>
    :root{
      --bg:#000;
      --fg:#fff;
      --muted:#8a8a8a;
      --card:#0e0e10;
      --btn:#1e1e1e;
      --btnHover:#2b2b2b;
      --radius:12px;
    }
    html,body{height:100%;margin:0}
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--fg);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:18px;
      box-sizing:border-box;
    }

    #container{width:min(720px,96vw);max-width:820px}
    h2{margin:0 0 14px;font-weight:600;font-size:1.15rem;text-align:center}
    #card{
      background:var(--card);
      padding:20px;
      border-radius:var(--radius);
      box-shadow:0 8px 28px rgba(0,0,0,.6);
      position:relative;
    }

    #content{
      min-height:110px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      border-radius:10px;
      background:transparent;
      color:var(--fg);
      font-size:1.05rem;
      line-height:1.5;
      text-align:center;
      opacity:0;
      transition:opacity .45s ease;
    }

    .controls{
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:center;
      margin-top:18px;
    }

    button{
      background:var(--btn);
      color:var(--fg);
      border:none;
      padding:12px 16px;
      border-radius:10px;
      cursor:pointer;
      font-size:1.1rem;
      transition:opacity .12s,transform .12s,background .12s;
    }
    button:hover:not(:disabled){ background:var(--btnHover); transform:translateY(-1px); }
    button:disabled{ opacity:.32; cursor:default; background:#0a0a0a; color:var(--muted); }

    /* specific */
    #stepBtn{ width:56px; height:56px; border-radius:10px; font-size:20px }
    #cycleBtn{ width:56px; height:56px; border-radius:10px; font-size:20px }
    #anchorBtn{ width:38px; height:34px; border-radius:8px; font-size:16px; padding:6px 8px }

    #anchorArea{ margin-top:12px; min-height:46px; display:flex; align-items:center; justify-content:center }
    #anchorText{
      opacity:0;
      transition:opacity 15000ms ease;
      color:var(--muted);
      text-align:center;
      max-width:82%;
      font-size:0.95rem;
      line-height:1.45;
    }

    /* info modal */
    #infoBtn{ position:fixed; bottom:14px; right:14px; background:none; color:var(--muted); border:none; font-size:18px; cursor:pointer; }
    #infoModal{
      display:none;
      position:fixed;
      top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.75);
      z-index:1100;
      align-items:center;
      justify-content:center;
      padding:20px;
      box-sizing:border-box;
    }
    #infoModalContent{
      background:var(--card);
      color:var(--fg);
      padding:18px;
      border-radius:12px;
      max-width:420px;
      width:100%;
      max-height:80%;
      overflow:auto;
      position:relative;
      box-shadow:0 8px 36px rgba(0,0,0,.6);
      font-size:0.95rem;
      line-height:1.45;
    }
    #closeModal{ position:absolute; top:10px; right:12px; font-size:18px; background:none; border:none; color:var(--muted); cursor:pointer }

    /* small responsive */
    @media (max-width:480px){
      #content{ font-size:0.98rem; min-height:84px }
      #stepBtn, #cycleBtn{ width:48px; height:48px; font-size:18px }
    }
  </style>
</head>
<body>
  <div id="container">
    <h2>OpenSpace — Dzogchen Pointing-Out</h2>
    <div id="card">
      <div id="content">Click the left dot to begin.</div>

      <div class="controls" aria-hidden="false">
        <button id="stepBtn" aria-label="Step">●</button>
        <button id="cycleBtn" aria-label="Next iteration" disabled>○</button>
      </div>

      <div style="display:flex;flex-direction:column;align-items:center">
        <div style="margin-top:10px;">
          <button id="anchorBtn" aria-label="Anchor" disabled>⚓</button>
        </div>
        <div id="anchorArea"><div id="anchorText"></div></div>
      </div>
    </div>
  </div>

  <!-- Info modal -->
  <div id="infoModal" role="dialog" aria-hidden="true">
    <div id="infoModalContent">
      <button id="closeModal" aria-label="Close help">×</button>
      <h3 style="margin-top:0;margin-bottom:6px;">How this works</h3>
      <p>Left dot steps through the four phases of an iteration: <em>phenomenon → space → revelation → rest</em>. When you reach the end of the iteration the left dot disables and the right dot becomes available to start the next iteration. At that same moment an <strong>anchor</strong> (a lineage quote) becomes available — press it once to receive a short pointing-out quote that fades in and out over 30 seconds.</p>
      <p><strong>Note:</strong> Anchor quotes are drawn from recognized Dzogchen masters as pointers. They are intended as invitations to look, not as guarantees or substitutes for direct teaching with a qualified teacher.</p>
    </div>
  </div>

  <button id="infoBtn" aria-label="Help">ℹ️</button>

  <script>
    /* ---------- Prompt pools (expanded) ---------- */
    const phenomena = [
      "Notice the next thought that appears.","Notice the next emotion that surfaces.","Notice any bodily sensation you can feel.",
      "Notice the first sound you hear right now.","Notice a memory that comes to mind.","Notice a fleeting image in your mind.",
      "Notice an impulse or urge that arises.","Notice tension or relaxation in your body.","Notice any taste, smell, or subtle sensation.",
      "Notice the feeling of your posture.","Notice a judgment or evaluation as it arises.","Notice any desire or aversion appearing.",
      "Notice a flicker of attention in your mind.","Notice a pause, blank, or gap in thought.","Notice the flow of breath without changing it.",
      "Notice a subtle feeling of comfort or discomfort.","Notice curiosity arising in your awareness.","Notice agitation or restlessness.",
      "Notice a fleeting visual impression in the environment.","Notice an internal dialogue or narrative forming.","Notice a small ache or ease in the body.",
      "Notice a passing preference or dislike.","Notice the edges of your attention.","Notice a faint mental image that appears.",
      "Notice the sound your clothes or chair makes.","Notice a recent thought about the future.","Notice the feeling behind a remembered word.",
      "Notice the subtle holding in your hands or fingers.","Notice any urge to look away or avoid.","Notice a gentle warmth or coolness in the skin.",
      "Notice the light changing in the room.","Notice the rhythm of your heartbeat.","Notice the space between breaths.",
      "Notice a smell from the environment.","Notice a memory from childhood.","Notice a small muscle twitch.",
      "Notice your feet touching the floor.","Notice your hands resting.","Notice the temperature in your fingers.",
      "Notice the sound of your own breathing.","Notice the weight of your body on the chair.","Notice subtle thoughts passing.",
      "Notice tension in your jaw or face.","Notice a shift in your posture.","Notice your eyelids and gaze.",
      "Notice a fleeting emotion briefly.","Notice a color you hadn’t observed.","Notice a lingering mental image.",
      "Notice subtle movement in your hands.","Notice a background noise appearing.","Notice a faint smell lingering.",
      "Notice a mental habit.","Notice the pulse in your temples.","Notice any urge to adjust your body.",
      "Notice the temperature of your breath.","Notice the sense of balance in sitting.","Notice the horizon or edge of vision.",
      "Notice a faint itch or touch.","Notice the tension in shoulders or neck.",
      /* added entries emphasizing perception & inseparability */
      "Notice subtle emotional tones beneath thoughts.","Notice the texture of the present moment.","Notice openness behind sensation.",
      "Notice the movement of attention itself.","Notice how sound arises unbidden.","Notice stillness behind all motion.",
      "Notice the immediate presence before labeling.","Notice the rawness of perception.","Notice how a thought fades on its own.",
      "Notice the boundary between self and sensation dissolving."
    ];

    const spaceCues = [
      "Now notice the space in which that appears.","Shift from the arising object to the openness it inhabits.",
      "Let the image soften; sense the formless ground hosting it.","Notice the simple knowing that doesn't grab the content.",
      "Sense the ungraspable background where this shows up.","Without changing anything, sense the openness that's aware.",
      "Notice how the appearance is simply occurring in this field.","Feel the space that is present even when form is vivid.",
      "Note the clarity that notices without effort.","Allow attention to rest in the open knowing around the object.",
      "Sense the nonreferential space behind the appearance.","Notice that the space doesn't need the content to be itself.",
      "Notice the stillness that contains motion and thought.","Sense how this shows up and shows itself without you doing anything.",
      "Let the background be known as background, not a new object.",
      "Notice the mind’s awareness as the container.","Observe the openness holding all forms.","Feel the spaciousness beneath thoughts.",
      "Rest in the awareness observing itself.","Notice the clarity pervading the mental landscape.","Allow the openness to be self-evident.",
      "Notice how objects arise and dissolve in space.","Sense the field where attention rests naturally.","Notice the horizon of awareness encompassing everything.",
      "Allow the mind’s natural presence to be felt.","Notice the luminous clarity behind sensations.","Rest in the unbounded ground of mind.",
      "Notice the gap between mental events.","Observe how awareness remains unshaken.","Sense the non-dual openness of this moment.",
      "Notice that awareness has no edges.","Sense the expanse that holds even contraction.","Notice how appearances float in openness.",
      "Feel the inseparability of space and movement.","Sense the vividness and spaciousness as one.","Notice the transparency of the arising phenomenon.",
      "Let the openness reveal itself as naturally present.","Rest in the boundlessness that is already here."
    ];

    const revelationCues = [
      "This openness wasn't created just now.","You didn't produce this space — it's already present.",
      "The object arose and passed; the knowing remained.","The openness is unchanged by whatever appears.",
      "You cannot step outside this awareness — it's the ground of all.","This seeing is not something you must assemble.",
      "Even when unnoticing occurs, it too arises in the same space.","No addition is required for this to be present.",
      "This is not a state to obtain; it is what appears in all states.","Recognize that nothing could be missing from this field.",
      "This awareness is prior to concept.","Notice the primordial clarity is always present.","The ground of mind is luminous and open.",
      "All arising is within the natural state.","No effort can create this space; it simply is.","Even confusion arises in this openness.",
      "Recognize the immediacy of presence.","No object can limit this awareness.","This is the natural state, already complete.",
      "Everything unfolds within awareness without interference.","Awareness does not come or go.","The clarity of mind is timeless.",
      "The ground is self-revealing.","The nature of awareness is inseparable from its display.",
      "Nothing can obscure the essence, only your noticing.","All movement is the radiance of awareness.","Rigpa is present even when unnoticed.",
      "The essence has never been altered."
    ];

    const restingCues = [
      "Rest here for a moment.","Let everything be exactly as it is.","No need to hold the view; notice it holds itself.",
      "There's nothing to maintain and nothing to lose.","Simply remain in this effortless openness.","Allow the moment to be as it is without doing.",
      "Stay with the felt sense of not having to fix anything.","Breathe lightly and rest in what is aware.",
      "Allow awareness to rest naturally.","Notice the ease of simply being.","No need to interfere with experience.",
      "Rest in the natural rhythm of mind.","Let each moment be sufficient unto itself.","Feel the spaciousness beneath all phenomena.",
      "Notice the effortless continuity of presence.","Relax into the unconditioned ground of mind.",
      "Let stillness reveal itself.","Rest as the space in which sensations arise.","Let the vividness of experience rest on its own.",
      "Do nothing and let awareness remain as it is.","Rest in the inseparability of openness and clarity.",
      "Let the ground of being support itself.","Relax all effort, even subtle effort.","Let experience be self-liberating."
    ];

    const anchorCues = [
      "In Dzogchen we discover that the root of the mind is awareness or rigpa. This is our true condition. — Namkhai Norbu Rinpoche",
      "When we recognize that the seemingly object nature of reality is nothing different than the subject nature of mind, which is rigpa, it is called enlightenment. — Dzogchen Ponlop Rinpoche",
      "Whatever arises in the mind … just let it be, and it will naturally release itself. — Patrul Rinpoche",
      "The nature of mind is Buddha from the very beginning. — Padmasambhava",
      "This openness was not created just now. — Traditional Dzogchen teaching",
      "Rest in natural great peace. — Traditional Dzogchen teaching",
      "All phenomena are empty, and the nature of mind is already clear. — Tulku Urgyen Rinpoche",
      "In the state of non-dual awareness, nothing is lacking. — Tulku Urgyen Rinpoche",
      "The mind's essence is like space: limitless, luminous, and ungraspable. — Longchenpa",
      "Know the ground; it is free of all elaboration. — Longchenpa",
      "Those who realize the mind see the essence beyond form. — Saraha",
      "Do not seek outside; the essence is here, present as awareness. — Tilopa",
      "All experiences are manifestations of the innate awareness; recognize it as such. — Tilopa",
      /* additional lineage pith */
      "Whatever you meet, meet it as the display of awareness. — Traditional pointer",
      "Look directly at the mind that knows. — Traditional pointer",
      "Not two — awareness and display are inseparable. — Traditional pointer",
      "Open and empty, this is the natural presence. — Traditional pointer",
      "Do not become attached to the appearance; rest in the openness. — Traditional pointer",
      "The view is the simplicity of what is already present. — Traditional pointer"
    ];

    /* ---------- shuffle-without-repetition helper ---------- */
    function createShuffler(arr){
      let pool = [...arr];
      return function(){
        if(pool.length === 0) pool = [...arr];
        const idx = Math.floor(Math.random()*pool.length);
        const item = pool[idx];
        pool.splice(idx,1);
        return item;
      };
    }

    const pickPhenomena = createShuffler(phenomena);
    const pickSpace = createShuffler(spaceCues);
    const pickRevelation = createShuffler(revelationCues);
    const pickResting = createShuffler(restingCues);
    const pickAnchor = createShuffler(anchorCues);

    /* ---------- state & elements ---------- */
    let phase = 0;
    const maxPhase = 4; // phases: 0..3 then complete
    const elContent = document.getElementById('content');
    const stepBtn = document.getElementById('stepBtn');
    const cycleBtn = document.getElementById('cycleBtn');
    const anchorBtn = document.getElementById('anchorBtn');
    const anchorText = document.getElementById('anchorText');
    const infoBtn = document.getElementById('infoBtn');
    const infoModal = document.getElementById('infoModal');
    const closeModal = document.getElementById('closeModal');

    let anchorTimeout = null;

    /* fade main text: fade out, set text, fade in */
    function fadeText(newText){
      // fade out
      elContent.style.opacity = '0';
      // after short delay swap and fade in
      setTimeout(()=>{
        elContent.textContent = newText;
        elContent.style.opacity = '1';
      }, 450);
    }

    /* ---------- interactions ---------- */
    function step(){
      if(stepBtn.disabled) return;
      let text = '';
      if(phase === 0) text = pickPhenomena();
      else if(phase === 1) text = pickSpace();
      else if(phase === 2) text = pickRevelation();
      else if(phase === 3) text = pickResting();

      fadeText(text);
      phase++;

      if(phase >= maxPhase){
        // iteration complete
        stepBtn.disabled = true;
        cycleBtn.disabled = false;
        anchorBtn.disabled = false; // anchor available once iteration completes
      }
    }

    function cycle(){
      if(cycleBtn.disabled) return;
      // start next iteration
      phase = 0;
      cycleBtn.disabled = true;
      anchorBtn.disabled = true;
      stepBtn.disabled = false;

      fadeText(pickPhenomena());
      phase = 1;
    }

    function showAnchor(){
      if(anchorBtn.disabled) return;

      // disable anchor while visible
      anchorBtn.disabled = true;

      // clear previous timeouts so each anchor gets full duration
      if(anchorTimeout) {
        clearTimeout(anchorTimeout);
        anchorTimeout = null;
      }

      // set anchor text and fade in
      anchorText.textContent = pickAnchor();
      // ensure immediate style change registers
      anchorText.style.opacity = '1';

      // visible duration: 15000ms, then fade out over 15000ms (transition CSS handles fade)
      anchorTimeout = setTimeout(()=>{
        anchorText.style.opacity = '0';
        // after fade-out completes, clear and re-enable if appropriate
        anchorTimeout = setTimeout(()=>{
          anchorText.textContent = '';
          // re-enable anchor only if cycle button is still enabled (iteration complete state)
          if(!cycleBtn.disabled) anchorBtn.disabled = false;
          anchorTimeout = null;
        }, 15000); // fade-out end
      }, 15000); // visible duration
    }

    /* ---------- wiring ---------- */
    stepBtn.addEventListener('click', step);
    cycleBtn.addEventListener('click', cycle);
    anchorBtn.addEventListener('click', showAnchor);
    infoBtn.addEventListener('click', ()=>{ infoModal.style.display = 'flex'; infoModal.setAttribute('aria-hidden','false'); });
    closeModal.addEventListener('click', ()=>{ infoModal.style.display = 'none'; infoModal.setAttribute('aria-hidden','true'); });

    /* keyboard: optional convenience */
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' ') {
        // space/enter = step if step active, else cycle if cycle active
        if(!stepBtn.disabled) { e.preventDefault(); step(); }
        else if(!cycleBtn.disabled) { e.preventDefault(); cycle(); }
      }
      // 'a' triggers anchor if available
      if(e.key === 'a' || e.key === 'A'){ if(!anchorBtn.disabled) showAnchor(); }
      // 'i' toggles info
      if(e.key === 'i' || e.key === 'I'){ infoModal.style.display = infoModal.style.display === 'flex' ? 'none' : 'flex'; }
    });

    /* initial states */
    stepBtn.disabled = false;
    cycleBtn.disabled = true;
    anchorBtn.disabled = true;

    // show a gentle starter message (visible)
    setTimeout(()=>{ fadeText("Click the left dot (●) to step through the first iteration."); }, 200);
  </script>
</body>
</html>
