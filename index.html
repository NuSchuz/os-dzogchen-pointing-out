<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OpenSpace — Pointing-Out Teachings (V8)</title>
  <style>
    :root{
      --bg:#000000;
      --fg:#ffffff;
      --muted:#8a8a8a;
      --cardTop:rgba(20,20,22,0.9);
      --cardBottom:rgba(10,10,12,0.85);
      --btn:#1e1e1e;
      --btnHover:#2b2b2b;
      --radius:14px;
    }

    html,body{height:100%;margin:0}

    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: radial-gradient(circle at top, #111 0%, #000 55%, #000 100%);
      color:var(--fg);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:18px;
      box-sizing:border-box;
    }

    #container{
      width:min(720px,96vw);
      max-width:820px;
    }

    /* Header: OpenSpace (big) + subtitle + info icon */
    #headerColumn{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom:14px;
    }

    #titleMain{
      margin:0;
      font-weight:700;
      font-size:1.5rem;
      line-height:1.2;
      letter-spacing:0.02em;
    }

    #subHeaderRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    #titleSub{
      margin:0;
      font-weight:500;
      font-size:1.02rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      color:var(--muted);
    }

    #infoBtn{
      flex:0 0 auto;
      width:22px;
      height:22px;
      border-radius:50%;
      border:none;
      padding:0;
      background:transparent;
      cursor:pointer;
      display:none; /* shown when a teaching is selected */
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 24 24' stroke='%23ffffff' stroke-width='2' fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='9'/%3E%3Cline x1='12' y1='10' x2='12' y2='16'/%3E%3Ccircle cx='12' cy='7' r='1'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:center;
      background-size:18px;
      opacity:0.85;
      transition:opacity .15s ease, transform .15s ease;
    }
    #infoBtn:hover{ opacity:1; transform:translateY(-1px); }

    /* Sound row under subtitle */
    #soundRow{
      display:flex;
      justify-content:flex-end;
      margin-top:2px;
    }
    #soundBtn{
      width:22px;
      height:22px;
      border-radius:50%;
      border:none;
      padding:0;
      background:transparent;
      cursor:pointer;
      display:none; /* only when teaching selected */
      background-repeat:no-repeat;
      background-position:center;
      background-size:18px;
      opacity:0.75;
      transition:opacity .15s ease, transform .15s ease;
    }
    #soundBtn:hover{
      opacity:1;
      transform:translateY(-1px);
    }

    /* Card: floating, gradient, soft shadow */
    #card{
      background:linear-gradient(180deg, var(--cardTop), var(--cardBottom));
      padding:20px 20px 22px 20px;
      border-radius:var(--radius);
      box-shadow:0 12px 40px rgba(0,0,0,.45);
      position:relative;
      backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,0.04);
      transition:transform .25s ease, box-shadow .25s ease;
    }
    #card:hover{
      transform:translateY(-2px);
      box-shadow:0 16px 48px rgba(0,0,0,.55);
    }

    #content{
      min-height:110px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      border-radius:12px;
      background:rgba(255,255,255,0.01);
      color:var(--fg);
      font-size:1.05rem;
      line-height:1.5;
      text-align:center;
      opacity:1;
      transition:opacity .45s ease;
    }

    .controls{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      margin-top:16px;
    }

    button{
      background:var(--btn);
      color:var(--fg);
      border:none;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-size:0.95rem;
      transition:
        opacity .12s,
        transform .12s,
        background .12s,
        box-shadow .12s;
      box-shadow:0 4px 12px rgba(0,0,0,0.4);
    }
    button:hover:not(:disabled){
      background:var(--btnHover);
      transform:translateY(-1px);
      box-shadow:0 6px 18px rgba(0,0,0,0.5);
    }
    button:disabled{
      opacity:.32;
      cursor:default;
      background:#0a0a0a;
      color:var(--muted);
      box-shadow:none;
    }

    #stepBtn,#cycleBtn{
      width:52px;
      height:52px;
      border-radius:12px;
      font-size:18px;
      padding:0;
    }

    #anchorBtn{
      width:38px;
      height:34px;
      border-radius:8px;
      padding:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' stroke='%23ffffff' stroke-width='2' fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='6' r='2'/%3E%3Cpath d='M12 8v10'/%3E%3Cpath d='M6 14c0 3.3 2.7 6 6 6s6-2.7 6-6'/%3E%3Cpath d='M6 14l2 2'/%3E%3Cpath d='M18 14l-2 2'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:center;
      background-size:20px;
    }

    /* Menu toggle + menu bar (left-aligned, small) */
    #menuToggleRow{
      display:flex;
      justify-content:flex-start;
      margin-bottom:6px;
    }
    #menuToggleBtn{
      width:26px;
      height:26px;
      padding:0;
      border-radius:8px;
      background:transparent;
      box-shadow:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' stroke='%23ffffff' stroke-width='2' fill='none' stroke-linecap='round'%3E%3Cline x1='4' y1='7' x2='20' y2='7'/%3E%3Cline x1='4' y1='12' x2='20' y2='12'/%3E%3Cline x1='4' y1='17' x2='20' y2='17'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:center;
      background-size:20px;
      opacity:0.9;
      transition:opacity .12s ease, transform .12s ease, background .12s ease;
    }
    #menuToggleBtn:hover{
      opacity:1;
      transform:translateY(-1px);
    }

    #menuBar{
      display:flex;
      gap:8px;
      justify-content:flex-start;
      margin-bottom:16px;
      flex-wrap:wrap;
      transition:max-height .25s ease, opacity .2s ease;
    }
    #menuBar button{
      font-size:0.85rem;
      padding:6px 10px;
      border-radius:8px;
      box-shadow:none;
      background:rgba(30,30,30,0.85);
    }
    #menuBar button:hover:not(:disabled){
      background:rgba(43,43,43,0.95);
    }

    /* Anchor area */
    #anchorArea{
      margin-top:12px;
      min-height:46px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    #anchorText{
      opacity:0;
      transition:opacity 15000ms ease;
      color:var(--muted);
      text-align:center;
      max-width:82%;
      font-size:0.95rem;
      line-height:1.45;
    }

    /* Info modal */
    #infoModal{
      display:none;
      position:fixed;
      top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.75);
      z-index:1100;
      align-items:center;
      justify-content:center;
      padding:20px;
      box-sizing:border-box;
    }
    #infoModalContent{
      background:rgba(10,10,12,0.96);
      color:var(--fg);
      padding:18px;
      border-radius:12px;
      max-width:420px;
      width:100%;
      max-height:80%;
      overflow:auto;
      position:relative;
      box-shadow:0 18px 50px rgba(0,0,0,.7);
      font-size:0.95rem;
      line-height:1.45;
      border:1px solid rgba(255,255,255,0.05);
    }
    #closeModal{
      position:absolute;
      top:10px;
      right:12px;
      font-size:18px;
      background:none;
      border:none;
      color:var(--muted);
      cursor:pointer;
    }
    #infoTitle{
      margin-top:0;
      margin-bottom:6px;
      font-size:1.02rem;
      font-weight:600;
    }

    @media (max-width:480px){
      #content{ font-size:0.98rem; min-height:84px }
      #stepBtn, #cycleBtn{ width:48px; height:48px; font-size:18px }
      #titleMain{ font-size:1.35rem; }
      #titleSub{ font-size:0.98rem; }
    }
  </style>
</head>
<body>
  <div id="container">

    <!-- Header -->
    <div id="headerColumn">
      <h1 id="titleMain">OpenSpace</h1>

      <div id="subHeaderRow">
        <h2 id="titleSub">Pointing-Out Teachings</h2>
        <button id="infoBtn" aria-label="Help"></button>
      </div>

      <div id="soundRow">
        <button id="soundBtn" aria-label="Toggle sound"></button>
      </div>
    </div>

    <!-- Menu toggle -->
    <div id="menuToggleRow">
      <button id="menuToggleBtn" aria-label="Toggle teaching menu"></button>
    </div>

    <!-- Teaching selector: Trekchö, Mahamudra, Freeform -->
    <div id="menuBar">
      <button id="trekchoBtn">Trekchö Cutting-Through</button>
      <button id="mahaBtn">Mahamudra Pointing-Out</button>
      <button id="dzogchenBtn">Dzogchen Freeform</button>
    </div>

    <!-- Main card -->
    <div id="card">

      <div id="content">Select a teaching to begin.</div>

      <div class="controls" aria-hidden="false">
        <button id="stepBtn" aria-label="Step" disabled style="display:none;">●</button>
        <button id="cycleBtn" aria-label="Next iteration" disabled style="display:none;">○</button>
      </div>

      <div style="display:flex;flex-direction:column;align-items:center">
        <div style="margin-top:10px;">
          <button id="anchorBtn" aria-label="Anchor" disabled style="display:none;"></button>
        </div>
        <div id="anchorArea">
          <div id="anchorText"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- Info modal -->
  <div id="infoModal" role="dialog" aria-hidden="true">
    <div id="infoModalContent">
      <button id="closeModal" aria-label="Close help">×</button>
      <h3 id="infoTitle">How this works</h3>
      <div id="infoBody"></div>
    </div>
  </div>
  <script>
    /* ---------- Audio setup ---------- */
    let audioCtx = null;
    let soundEnabled = false;
    let schumannNodes = null;

const SOUND_ICON_OFF =
"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 24 24' stroke='%23ffffff' stroke-width='2.6' fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='2.2'/%3E%3Cline x1='16' y1='9' x2='20' y2='13'/%3E%3Cline x1='20' y1='9' x2='16' y2='13'/%3E%3C/svg%3E";

const SOUND_ICON_ON =
"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 24 24' stroke='%23ffffff' stroke-width='2.6' fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='2.2'/%3E%3Cpath d='M15 12c1.3 .8 1.3 .8 2 0'/%3E%3C/svg%3E";

    function ensureAudioCtx(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function startSchumann(){
      ensureAudioCtx();
      stopSchumann();
      if(audioCtx.state === "suspended") audioCtx.resume();

      const carrier = audioCtx.createOscillator();
      carrier.type = "sine";
      carrier.frequency.value = 126; // Hz

      const gain = audioCtx.createGain();
      gain.gain.value = 0.15;

      const mod = audioCtx.createOscillator();
      mod.type = "sine";
      mod.frequency.value = 7.83; // Schumann resonance

      const modGain = audioCtx.createGain();
      modGain.gain.value = 0.07; // pulsing depth

      mod.connect(modGain).connect(gain.gain);
      carrier.connect(gain).connect(audioCtx.destination);

      carrier.start();
      mod.start();

      schumannNodes = { carrier, mod, gain, modGain };
    }

    function stopSchumann(){
      if(schumannNodes){
        try {
          schumannNodes.carrier.stop();
          schumannNodes.mod.stop();
        } catch(e){}
        schumannNodes = null;
      }
    }

    function playSolfeggio(freq){
      ensureAudioCtx();
      if(audioCtx.state === "suspended") audioCtx.resume();

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = "sine";
      osc.frequency.value = freq;

      const now = audioCtx.currentTime;
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(0.15, now + 0.15);
      gain.gain.linearRampToValueAtTime(0, now + 0.45);

      osc.connect(gain).connect(audioCtx.destination);
      osc.start(now);
      osc.stop(now + 0.6);
    }

    function playPhaseTone(){
  if(!soundEnabled) return;
  playSolfeggio(528);
}
    /* ---------- Teaching text sets ---------- */

    /* Dzogchen Freeform — four phases with random variations */
    const phenomenaList = [
      "Notice the next thought that appears.",
      "Notice the next emotion that surfaces.",
      "Notice the next sensation in the body.",
      "Notice the next sound you hear.",
      "Notice the next impulse to move or adjust.",
      "Notice the next mental image that arises.",
      "Notice the next expectation or subtle anticipation.",
      "Notice the next feeling of 'I should…' that appears."
    ];

    const spaceList = [
      "Notice the open space in which all appears.",
      "Notice the vastness around the appearance.",
      "Let attention rest wider than the thought.",
      "Notice the openness that doesn’t change when something appears.",
      "Notice the quiet space enveloping the sensation.",
      "Notice how the space is effortless and already present.",
      "Notice how nothing can be found that holds the experience in place."
    ];

    const revelationList = [
      "Notice the revealing that this openness and appearance are inseparable.",
      "Notice how the thought and the space share the same nature.",
      "Notice how sensation and openness come from the same source.",
      "Notice how emotion and space are not-two.",
      "Notice how the revealing is spontaneous—not created by you.",
      "Notice the recognition that this revealing has no center.",
      "Notice the simplicity of this recognition."
    ];

    const restList = [
      "Let everything rest exactly as it is.",
      "Rest without modifying anything.",
      "Rest the mind in its own natural state.",
      "Rest in awareness without pushing or pulling.",
      "Let resting happen on its own.",
      "Let experience be exactly as it is—nothing to change.",
      "Rest in the simplicity of presence."
    ];

    function pickPhenomena(){ return phenomenaList[Math.floor(Math.random()*phenomenaList.length)]; }
    function pickSpace(){ return spaceList[Math.floor(Math.random()*spaceList.length)]; }
    function pickRevelation(){ return revelationList[Math.floor(Math.random()*revelationList.length)]; }
    function pickResting(){ return restList[Math.floor(Math.random()*restList.length)]; }

    const maxPhase = 4;

    /* ---------- Trekchö Sequence ---------- */
    const trekcho = [
      "Sit naturally, not holding yourself in any special way.",
      "Let the gaze rest lightly, not focusing, not avoiding.",
      "Relax the body until it feels uncontrived.",
      "Notice the raw vividness of direct experience.",
      "Look for the mind that observes.",
      "Notice the looker cannot be found.",
      "Rest in this unfoundness.",
      "See appearances as self-arising, self-liberating.",
      "Nothing to accept, nothing to reject.",
      "Rest in effortless clarity.",
      "This is trekchö: cutting through to what is already present."
    ];

    /* ---------- Mahamudra Sequence ---------- */
    const mahamudra = [
      "Sit comfortably. Eyes open, gaze lowered.",
      "Relax jaw, lips apart, tongue on palate.",
      "Allow the breath to find its own rhythm.",
      "Let thoughts come and go without interference.",
      "Notice the stillness beneath movement.",
      "A thought arises—and dissolves instantly.",
      "Notice what changes and what doesn't.",
      "Rest attention in the natural clarity of mind.",
      "Movement arises in stillness, made of stillness.",
      "Look between thoughts: the natural state is present.",
      "Nothing to hold, nothing to push away.",
      "Relax even the meditation itself.",
      "Let recognition be effortless and natural."
    ];
    /* ---------- Fade helpers ---------- */

    function fadeTextFast(t){
      const el = document.getElementById('content');
      el.style.opacity = 0;
      setTimeout(()=>{
        el.textContent = t;
        el.style.opacity = 1;
      }, 450); /* fast fade */
    }

    function fadeTextSlow(t){
      const el = document.getElementById('content');
      el.style.opacity = 0;
      setTimeout(()=>{
        el.textContent = t;
        el.style.opacity = 1;
      }, 800); /* slow fade */
    }

    /* ---------- Menu collapse/expand ---------- */

    let menuOpen = true;
    const menuBar = document.getElementById('menuBar');
    const menuToggleBtn = document.getElementById('menuToggleBtn');

    function collapseMenu(){
      menuBar.style.maxHeight = "0";
      menuBar.style.opacity = "0";
      menuOpen = false;
    }

    function expandMenu(){
      menuBar.style.maxHeight = "400px";
      menuBar.style.opacity = "1";
      menuOpen = true;
    }

    menuToggleBtn.addEventListener("click", ()=>{
      if(menuOpen){ collapseMenu(); }
      else{ expandMenu(); }
    });

    /* ---------- Card text element ---------- */

    const elContent = document.getElementById('content');

    /* ---------- Control buttons ---------- */

    const stepBtn = document.getElementById('stepBtn');
    const cycleBtn = document.getElementById('cycleBtn');
    const anchorBtn = document.getElementById('anchorBtn');
    const anchorText = document.getElementById('anchorText');

    const infoBtn = document.getElementById('infoBtn');
    const soundBtn = document.getElementById('soundBtn');

    /* ---------- Info modal logic ---------- */

    const infoModal = document.getElementById('infoModal');
    const infoBody = document.getElementById('infoBody');
    const closeModal = document.getElementById('closeModal');

    closeModal.addEventListener('click', ()=>{
      infoModal.style.display = "none";
    });

    infoModal.addEventListener('click', (e)=>{
      if(e.target === infoModal){
        infoModal.style.display = "none";
      }
    });

    function showInfo(text){
      infoBody.innerHTML = text;
      infoModal.style.display = "flex";
    }

    infoBtn.onclick = ()=>{
      if(teachingMode === "trekcho"){
        showInfo(`
          <p><strong>Trekchö</strong> (Cutting Through) directly reveals the unfabricated nature of mind. 
          Each step points you to what is always present.</p>
          <p>Let each pointing be immediate—no analysis, no effort.</p>
        `);
      }
      else if(teachingMode === "mahamudra"){
        showInfo(`
          <p><strong>Mahamudra</strong> reveals the natural clarity of mind through resting, noticing, and releasing.</p>
          <p>These steps should feel simple and intimate, not forced.</p>
        `);
      }
      else if(teachingMode === "dzogchen"){
        showInfo(`
          <p><strong>Dzogchen Freeform</strong> cycles through four movements:
          Phenomena → Space → Revelation → Rest.</p>
          <p>Let the natural recognition arise on its own.</p>
        `);
      }
    };

    /* ---------- Sound UI updates ---------- */

    function updateSoundUI(){
      if(!soundBtn) return;
      soundBtn.style.opacity = soundEnabled ? '1' : '0.75';
      soundBtn.style.backgroundImage = "url('" + (soundEnabled ? SOUND_ICON_ON : SOUND_ICON_OFF) + "')";
    }

    soundBtn.addEventListener('click', ()=>{
      soundEnabled = !soundEnabled;
      ensureAudioCtx();
      if(audioCtx.state === "suspended") audioCtx.resume();

      if(soundEnabled){
        if(teachingMode === 'mahamudra' || teachingMode === 'trekcho'){
          startSchumann();
        }
      } else {
        stopSchumann();
      }
      updateSoundUI();
    });

    /* ---------- Teaching mode state ---------- */

    let teachingMode = null;
    let trekIndex = 0;
    let mahaIndex = 0;
    let phase = 0;

    function clearModeExtras(){
      stepBtn.style.display = 'none';
      cycleBtn.style.display = 'none';
      anchorBtn.style.display = 'none';
      anchorText.style.opacity = 0;
    }

    function showTrekchoControls(){
      stepBtn.style.display = 'inline-block';
      cycleBtn.style.display = 'none';
      anchorBtn.style.display = 'none';
      stepBtn.disabled = false;
      cycleBtn.disabled = true;
      anchorBtn.disabled = true;
      infoBtn.style.display = 'inline-block';
      soundBtn.style.display = 'inline-block';
    }

    function showMahamudraControls(){
      stepBtn.style.display = 'inline-block';
      cycleBtn.style.display = 'none';
      anchorBtn.style.display = 'none';
      stepBtn.disabled = false;
      cycleBtn.disabled = true;
      anchorBtn.disabled = true;
      infoBtn.style.display = 'inline-block';
      soundBtn.style.display = 'inline-block';
    }

    function showDzogchenControls(){
      stepBtn.style.display = 'inline-block';
      cycleBtn.style.display = 'inline-block';
      anchorBtn.style.display = 'inline-block';
      stepBtn.disabled = false;
      cycleBtn.disabled = true;
      anchorBtn.disabled = true;
      infoBtn.style.display = 'inline-block';
      soundBtn.style.display = 'inline-block';
    }
    /* ---------- Teaching mode selection ---------- */

    function setModeTrekcho(){
      teachingMode = 'trekcho';
      trekIndex = 0;
      clearModeExtras();
      showTrekchoControls();
      fadeTextSlow('Trekchö — click the left dot (●) to begin.');
      collapseMenu();

      stopSchumann(); // reset
      if(soundEnabled) startSchumann();
    }

    function setModeMahamudra(){
      teachingMode = 'mahamudra';
      mahaIndex = 0;
      clearModeExtras();
      showMahamudraControls();
      fadeTextSlow('Mahamudra — click the left dot (●) to begin.');
      collapseMenu();

      stopSchumann(); // reset
      if(soundEnabled) startSchumann();
    }

    function setModeDzogchen(){
      teachingMode = 'dzogchen';
      phase = 0;
      clearModeExtras();
      showDzogchenControls();
      fadeTextFast('Click the left dot (●) to step through the first iteration.');
      collapseMenu();

      stopSchumann(); // no hum during Dzogchen
    }

    document.getElementById('trekchoBtn').onclick = setModeTrekcho;
    document.getElementById('mahaBtn').onclick = setModeMahamudra;
    document.getElementById('dzogchenBtn').onclick = setModeDzogchen;

    /* ---------- Main STEP logic ---------- */

    function step(){
      if(stepBtn.disabled) return;

      /* --- TREKCHÖ --- */
      if(teachingMode === 'trekcho'){
        fadeTextSlow(trekcho[trekIndex]);
        trekIndex++;

        if(trekIndex >= trekcho.length){
          stepBtn.disabled = true;
          fadeTextSlow("Trekchö complete.");
          collapseMenu(); // optional behavior
        }
        return;
      }

      /* --- MAHAMUDRA --- */
      if(teachingMode === 'mahamudra'){
        fadeTextSlow(mahamudra[mahaIndex]);
        mahaIndex++;

        if(mahaIndex >= mahamudra.length){
          stepBtn.disabled = true;
          fadeTextSlow("Mahamudra complete.");
          collapseMenu();
        }
        return;
      }

      /* --- DZOGCHEN FREEFORM --- */
      if(teachingMode === 'dzogchen'){
        let text = "";
        if(phase === 0) text = pickPhenomena();
        else if(phase === 1) text = pickSpace();
        else if(phase === 2) text = pickRevelation();
        else if(phase === 3) text = pickResting();

        playPhaseTone(phase);
        fadeTextFast(text);
        phase++;

        if(phase >= maxPhase){
          stepBtn.disabled = true;
          cycleBtn.disabled = false;
          anchorBtn.disabled = false;
        }
        return;
      }
    }

    stepBtn.onclick = step;

    /* ---------- Cycle logic (Dzogchen only) ---------- */

    function cycle(){
      if(teachingMode !== 'dzogchen') return;
      phase = 0;
      stepBtn.disabled = false;
      cycleBtn.disabled = true;
      anchorBtn.disabled = true;
      fadeTextFast("New iteration. Click ● again.");
    }

    cycleBtn.onclick = cycle;

    /* ---------- Anchor logic (Dzogchen) ---------- */

    anchorBtn.onclick = ()=>{
      if(teachingMode !== 'dzogchen') return;

      anchorText.style.opacity = 0;
      setTimeout(()=>{
        anchorText.textContent = 
          "This recognition does not depend on any particular step. " +
          "It is already present, even now.";
        anchorText.style.opacity = 1;
      }, 50);
    };
    /* ---------- Initial startup state ---------- */

    // No teaching selected at load
    stepBtn.disabled = true;
    cycleBtn.disabled = true;
    anchorBtn.disabled = true;

    stepBtn.style.display = 'none';
    cycleBtn.style.display = 'none';
    anchorBtn.style.display = 'none';

    infoBtn.style.display = 'none';
    soundBtn.style.display = 'none';

    // Menu open by default
    expandMenu();

    // Sound starts OFF
    soundEnabled = false;
    updateSoundUI();
  </script>
</body>
</html>
